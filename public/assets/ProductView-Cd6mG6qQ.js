import{S as qt,q as Kt,v as ot,x as Wt,y as Gt,z as D,A as Ht,B as Xt,C as ke,D as Yt,w as x,E as Qt,G as Jt,H as Vt,I as Zt,J as xt,p as Te,e as Y,K as b,i as Z,L as er,M as lt,N as tr,f as St,O as J,P as rr,Q as nr,T as sr,U as at,d as Je,c as H,o as X,a as S,V as Ze,n as xe,t as Ae,_ as wt,W as ir,X as or,Y as lr,Z as Ie,$ as ut,k as ct,m as ar,h as Se,a0 as pe,F as Fe,r as Xe,a1 as ur,a2 as cr}from"./index-Ctxg39xo.js";import{u as dr,g as fr,a as vr}from"./get-product-image.action-3yarFjY4.js";var mr=class extends qt{#t;#n=void 0;#e;#r;constructor(e,t){super(),this.#t=e,this.setOptions(t),this.bindMethods(),this.#s()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#t.defaultMutationOptions(e),Kt(this.options,t)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&ot(t.mutationKey)!==ot(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#s(),this.#i(e)}getCurrentResult(){return this.#n}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#s(),this.#i()}mutate(e,t){return this.#r=t,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#s(){const e=this.#e?.state??Wt();this.#n={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#i(e){Gt.batch(()=>{if(this.#r&&this.hasListeners()){const t=this.#n.variables,r=this.#n.context,s={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,t,r,s),this.#r.onSettled?.(e.data,null,t,r,s)):e?.type==="error"&&(this.#r.onError?.(e.error,t,r,s),this.#r.onSettled?.(void 0,e.error,t,r,s))}this.listeners.forEach(t=>{t(this.#n)})})}};function pr(e,t){const r=dr(),s=D(()=>{const f=typeof e=="function"?e():e;return r.defaultMutationOptions(Ht(f))}),l=new mr(r,s.value),o=s.value.shallow?Xt(l.getCurrentResult()):ke(l.getCurrentResult()),v=l.subscribe(f=>{Yt(o,f)}),y=(f,E)=>{l.mutate(f,E).catch(()=>{})};x(s,()=>{l.setOptions(s.value)}),Qt(()=>{v()});const c=s.value.shallow?Jt(o):Vt(o),d=Zt(c);return x(()=>o.error,f=>{if(f&&xt(s.value.throwOnError,[f]))throw f}),{...d,mutate:y,mutateAsync:o.mutate,reset:o.reset}}const hr=async e=>{if(e==="create")return{id:"",title:"",slug:"",description:"",price:0,stock:0,images:[],tags:[],sizes:[],gender:"",user:{}};try{const{data:t}=await Te.get(`/products/${e}`);return console.log({data:t}),{...t,images:t.images.map(fr)}}catch(t){throw console.log(t),new Error(`Error getting product by id ${e}`)}},gr=async e=>{const t=e.id,r=await Vr(e.images??[]);return e.images=r,e=yr(e),t&&t!==""?await br(t,e):await Or(e)},yr=e=>{const t=e.images?.map(r=>r.startsWith("http")?r.split("/").pop()?r:"":r)??[];return delete e.id,delete e.user,e.images=t,e},br=async(e,t)=>{try{const{data:r}=await Te.patch(`/products/${e}`,t);return r}catch(r){throw console.log(r),new Error("Error updating product")}},Or=async e=>{try{const{data:t}=await Te.post("/products",e);return t}catch(t){throw console.log(t),new Error("Error creating product")}},Vr=async e=>{const t=e.filter(o=>o instanceof File),r=e.filter(o=>typeof o=="string"),s=t.map(async o=>{try{const v=new FormData;v.append("file",o);const{data:y}=await Te.post("/files/product",v);return y.secureUrl}catch(v){throw console.log(v),new Error("Error uploading image")}}),l=await Promise.all(s);return[...r,...l]};function Q(e){return typeof e=="function"}function he(e){return e==null}const ge=e=>e!==null&&!!e&&typeof e=="object"&&!Array.isArray(e);function et(e){return Number(e)>=0}function Sr(e){return typeof e=="object"&&e!==null}function wr(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function dt(e){if(!Sr(e)||wr(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ee(e,t){return Object.keys(t).forEach(r=>{if(dt(t[r])&&dt(e[r])){e[r]||(e[r]={}),Ee(e[r],t[r]);return}e[r]=t[r]}),e}function Pe(e){const t=e.split(".");if(!t.length)return"";let r=String(t[0]);for(let s=1;s<t.length;s++){if(et(t[s])){r+=`[${t[s]}]`;continue}r+=`.${t[s]}`}return r}const Ar={};function Er(e){return Ar[e]}function ft(e,t,r){typeof r.value=="object"&&(r.value=A(r.value)),!r.enumerable||r.get||r.set||!r.configurable||!r.writable||t==="__proto__"?Object.defineProperty(e,t,r):e[t]=r.value}function A(e){if(typeof e!="object")return e;var t=0,r,s,l,o=Object.prototype.toString.call(e);if(o==="[object Object]"?l=Object.create(e.__proto__||null):o==="[object Array]"?l=Array(e.length):o==="[object Set]"?(l=new Set,e.forEach(function(v){l.add(A(v))})):o==="[object Map]"?(l=new Map,e.forEach(function(v,y){l.set(A(y),A(v))})):o==="[object Date]"?l=new Date(+e):o==="[object RegExp]"?l=new RegExp(e.source,e.flags):o==="[object DataView]"?l=new e.constructor(A(e.buffer)):o==="[object ArrayBuffer]"?l=e.slice(0):o.slice(-6)==="Array]"&&(l=new e.constructor(e)),l){for(s=Object.getOwnPropertySymbols(e);t<s.length;t++)ft(l,s[t],Object.getOwnPropertyDescriptor(e,s[t]));for(t=0,s=Object.getOwnPropertyNames(e);t<s.length;t++)Object.hasOwnProperty.call(l,r=s[t])&&l[r]===e[r]||ft(l,r,Object.getOwnPropertyDescriptor(e,r))}return l||e}const At=Symbol("vee-validate-form"),jr=Symbol("vee-validate-form-context"),Cr=typeof window<"u";function Ir(e){return Q(e)&&!!e.__locatorRef}function se(e){return!!e&&Q(e.parse)&&e.__type==="VVTypedSchema"}function Et(e){return!!e&&Q(e.validate)}function Fr(e){return e==="checkbox"||e==="radio"}function Pr(e){return ge(e)||Array.isArray(e)}function _r(e){return Array.isArray(e)?e.length===0:ge(e)&&Object.keys(e).length===0}function Me(e){return/^\[.+\]$/i.test(e)}function Nr(e){return jt(e)&&e.multiple}function jt(e){return e.tagName==="SELECT"}function kr(e){return Ct(e)&&e.target&&"submit"in e.target}function Ct(e){return e?!!(typeof Event<"u"&&Q(Event)&&e instanceof Event||e&&e.srcElement):!1}function ie(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,l;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!ie(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!ie(s[1],t.get(s[0])))return!1;return!0}if(mt(e)&&mt(t))return!(e.size!==t.size||e.name!==t.name||e.lastModified!==t.lastModified||e.type!==t.type);if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(e=vt(e),t=vt(t),l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,l[s]))return!1;for(s=r;s--!==0;){var o=l[s];if(!ie(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function vt(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}function mt(e){return Cr?e instanceof File:!1}function tt(e){return Me(e)?e.replace(/\[|\]/gi,""):e}function M(e,t,r){return e?Me(t)?e[tt(t)]:(t||"").split(/\.|\[(\d+)\]/).filter(Boolean).reduce((l,o)=>Pr(l)&&o in l?l[o]:r,e):r}function R(e,t,r){if(Me(t)){e[tt(t)]=r;return}const s=t.split(/\.|\[(\d+)\]/).filter(Boolean);let l=e;for(let o=0;o<s.length;o++){if(o===s.length-1){l[s[o]]=r;return}(!(s[o]in l)||he(l[s[o]]))&&(l[s[o]]=et(s[o+1])?[]:{}),l=l[s[o]]}}function Ye(e,t){if(Array.isArray(e)&&et(t)){e.splice(Number(t),1);return}ge(e)&&delete e[t]}function pt(e,t){if(Me(t)){delete e[tt(t)];return}const r=t.split(/\.|\[(\d+)\]/).filter(Boolean);let s=e;for(let o=0;o<r.length;o++){if(o===r.length-1){Ye(s,r[o]);break}if(!(r[o]in s)||he(s[r[o]]))break;s=s[r[o]]}const l=r.map((o,v)=>M(e,r.slice(0,v).join(".")));for(let o=l.length-1;o>=0;o--)if(_r(l[o])){if(o===0){Ye(e,r[0]);continue}Ye(l[o-1],r[o-1])}}function G(e){return Object.keys(e)}function Tr(e,t=void 0){const r=nr();return r?.provides[e]||sr(e,t)}function ht(e,t=0){let r=null,s=[];return function(...l){return r&&clearTimeout(r),r=setTimeout(()=>{const o=e(...l);s.forEach(v=>v(o)),s=[]},t),new Promise(o=>s.push(o))}}function Mr(e,t){let r;return async function(...l){const o=e(...l);r=o;const v=await o;return o!==r?v:(r=void 0,t(v,l))}}function Rr({get:e,set:t}){const r=Y(A(e()));return x(e,s=>{ie(s,r.value)||(r.value=A(s))},{deep:!0}),x(r,s=>{ie(s,e())||t(A(s))},{deep:!0}),r}function gt(e){return Array.isArray(e)?e:e?[e]:[]}function _e(e,t){const r={};for(const s in e)t.includes(s)||(r[s]=e[s]);return r}function $r(e){let t=null,r=[];return function(...s){const l=J(()=>{if(t!==l)return;const o=e(...s);r.forEach(v=>v(o)),r=[],t=null});return t=l,new Promise(o=>r.push(o))}}function Qe(e){if(It(e))return e._value}function It(e){return"_value"in e}function Ur(e){return e.type==="number"||e.type==="range"?Number.isNaN(e.valueAsNumber)?e.value:e.valueAsNumber:e.value}function yt(e){if(!Ct(e))return e;const t=e.target;if(Fr(t.type)&&It(t))return Qe(t);if(t.type==="file"&&t.files){const r=Array.from(t.files);return t.multiple?r:r[0]}if(Nr(t))return Array.from(t.options).filter(r=>r.selected&&!r.disabled).map(Qe);if(jt(t)){const r=Array.from(t.options).find(s=>s.selected);return r?Qe(r):t.value}return Ur(t)}function zr(e){const t={};return Object.defineProperty(t,"_$$isNormalized",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e?ge(e)&&e._$$isNormalized?e:ge(e)?Object.keys(e).reduce((r,s)=>{const l=Dr(e[s]);return e[s]!==!1&&(r[s]=bt(l)),r},t):typeof e!="string"?t:e.split("|").reduce((r,s)=>{const l=Br(s);return l.name&&(r[l.name]=bt(l.params)),r},t):t}function Dr(e){return e===!0?[]:Array.isArray(e)||ge(e)?e:[e]}function bt(e){const t=r=>typeof r=="string"&&r[0]==="@"?Lr(r.slice(1)):r;return Array.isArray(e)?e.map(t):e instanceof RegExp?[e]:Object.keys(e).reduce((r,s)=>(r[s]=t(e[s]),r),{})}const Br=e=>{let t=[];const r=e.split(":")[0];return e.includes(":")&&(t=e.split(":").slice(1).join(":").split(",")),{name:r,params:t}};function Lr(e){const t=r=>{var s;return(s=M(r,e))!==null&&s!==void 0?s:r[e]};return t.__locatorRef=e,t}const qr={generateMessage:({field:e})=>`${e} is not valid.`,bails:!0,validateOnBlur:!0,validateOnChange:!0,validateOnInput:!1,validateOnModelUpdate:!0};let Kr=Object.assign({},qr);const we=()=>Kr;async function Wr(e,t,r={}){const s=r?.bails,l={name:r?.name||"{field}",rules:t,label:r?.label,bails:s??!0,formData:r?.values||{}},o=await Gr(l,e);return Object.assign(Object.assign({},o),{valid:!o.errors.length})}async function Gr(e,t){const r=e.rules;if(se(r)||Et(r))return Xr(t,Object.assign(Object.assign({},e),{rules:r}));if(Q(r)||Array.isArray(r)){const y={field:e.label||e.name,name:e.name,label:e.label,form:e.formData,value:t},c=Array.isArray(r)?r:[r],d=c.length,f=[];for(let E=0;E<d;E++){const I=c[E],N=await I(t,y);if(!(typeof N!="string"&&!Array.isArray(N)&&N)){if(Array.isArray(N))f.push(...N);else{const K=typeof N=="string"?N:Pt(y);f.push(K)}if(e.bails)return{errors:f}}}return{errors:f}}const s=Object.assign(Object.assign({},e),{rules:zr(r)}),l=[],o=Object.keys(s.rules),v=o.length;for(let y=0;y<v;y++){const c=o[y],d=await Yr(s,t,{name:c,params:s.rules[c]});if(d.error&&(l.push(d.error),e.bails))return{errors:l}}return{errors:l}}function Hr(e){return!!e&&e.name==="ValidationError"}function Ft(e){return{__type:"VVTypedSchema",async parse(r,s){var l;try{return{output:await e.validate(r,{abortEarly:!1,context:s?.formData||{}}),errors:[]}}catch(o){if(!Hr(o))throw o;if(!(!((l=o.inner)===null||l===void 0)&&l.length)&&o.errors.length)return{errors:[{path:o.path,errors:o.errors}]};const v=o.inner.reduce((y,c)=>{const d=c.path||"";return y[d]||(y[d]={errors:[],path:d}),y[d].errors.push(...c.errors),y},{});return{errors:Object.values(v)}}}}}async function Xr(e,t){const s=await(se(t.rules)?t.rules:Ft(t.rules)).parse(e,{formData:t.formData}),l=[];for(const o of s.errors)o.errors.length&&l.push(...o.errors);return{value:s.value,errors:l}}async function Yr(e,t,r){const s=Er(r.name);if(!s)throw new Error(`No such validator '${r.name}' exists.`);const l=Qr(r.params,e.formData),o={field:e.label||e.name,name:e.name,label:e.label,value:t,form:e.formData,rule:Object.assign(Object.assign({},r),{params:l})},v=await s(t,l,o);return typeof v=="string"?{error:v}:{error:v?void 0:Pt(o)}}function Pt(e){const t=we().generateMessage;return t?t(e):"Field is invalid"}function Qr(e,t){const r=s=>Ir(s)?s(t):s;return Array.isArray(e)?e.map(r):Object.keys(e).reduce((s,l)=>(s[l]=r(e[l]),s),{})}async function Jr(e,t){const s=await(se(e)?e:Ft(e)).parse(A(t),{formData:A(t)}),l={},o={};for(const v of s.errors){const y=v.errors,c=(v.path||"").replace(/\["(\d+)"\]/g,(d,f)=>`[${f}]`);l[c]={valid:!y.length,errors:y},y.length&&(o[c]=y[0])}return{valid:!s.errors.length,results:l,errors:o,values:s.value,source:"schema"}}async function Zr(e,t,r){const l=G(e).map(async d=>{var f,E,I;const N=(f=r?.names)===null||f===void 0?void 0:f[d],B=await Wr(M(t,d),e[d],{name:N?.name||d,label:N?.label,values:t,bails:(I=(E=r?.bailsMap)===null||E===void 0?void 0:E[d])!==null&&I!==void 0?I:!0});return Object.assign(Object.assign({},B),{path:d})});let o=!0;const v=await Promise.all(l),y={},c={};for(const d of v)y[d.path]={valid:d.valid,errors:d.errors},d.valid||(o=!1,c[d.path]=d.errors[0]);return{valid:o,results:y,errors:c,source:"schema"}}let xr=0;const Ne=["bails","fieldsCount","id","multiple","type","validate"];function _t(e){const t=e?.initialValues||{},r=Object.assign({},b(t)),s=Z(e?.validationSchema);return s&&se(s)&&Q(s.cast)?A(s.cast(r)||{}):A(r)}function en(e){var t;const r=xr++,s=e?.name||"Form";let l=0;const o=Y(!1),v=Y(!1),y=Y(0),c=[],d=ke(_t(e)),f=Y([]),E=Y({}),I=Y({}),N=$r(()=>{I.value=f.value.reduce((i,n)=>(i[Pe(b(n.path))]=n,i),{})});function B(i,n){const a=T(i);if(!a){typeof i=="string"&&(E.value[Pe(i)]=gt(n));return}if(typeof i=="string"){const u=Pe(i);E.value[u]&&delete E.value[u]}a.errors=gt(n),a.valid=!a.errors.length}function K(i){G(i).forEach(n=>{B(n,i[n])})}e?.initialErrors&&K(e.initialErrors);const oe=D(()=>{const i=f.value.reduce((n,a)=>(a.errors.length&&(n[b(a.path)]=a.errors),n),{});return Object.assign(Object.assign({},E.value),i)}),re=D(()=>G(oe.value).reduce((i,n)=>{const a=oe.value[n];return a?.length&&(i[n]=a[0]),i},{})),ye=D(()=>f.value.reduce((i,n)=>(i[b(n.path)]={name:b(n.path)||"",label:n.label||""},i),{})),be=D(()=>f.value.reduce((i,n)=>{var a;return i[b(n.path)]=(a=n.bails)!==null&&a!==void 0?a:!0,i},{})),le=Object.assign({},e?.initialErrors||{}),g=(t=e?.keepValuesOnUnmount)!==null&&t!==void 0?t:!1,{initialValues:m,originalInitialValues:O,setInitialValues:w}=rn(f,d,e),j=tn(f,d,O,re),C=D(()=>f.value.reduce((i,n)=>{const a=M(d,b(n.path));return R(i,b(n.path),a),i},{})),F=e?.validationSchema;function L(i,n){var a,u;const h=D(()=>M(m.value,b(i))),V=I.value[b(i)],p=n?.type==="checkbox"||n?.type==="radio";if(V&&p){V.multiple=!0;const W=l++;return Array.isArray(V.id)?V.id.push(W):V.id=[V.id,W],V.fieldsCount++,V.__flags.pendingUnmount[W]=!1,V}const _=D(()=>M(d,b(i))),k=b(i),U=ue.findIndex(W=>W===k);U!==-1&&ue.splice(U,1);const P=D(()=>{var W,Ve,Ke,We;const Ge=b(F);if(se(Ge))return(Ve=(W=Ge.describe)===null||W===void 0?void 0:W.call(Ge,b(i)).required)!==null&&Ve!==void 0?Ve:!1;const He=b(n?.schema);return se(He)&&(We=(Ke=He.describe)===null||Ke===void 0?void 0:Ke.call(He).required)!==null&&We!==void 0?We:!1}),z=l++,q=ke({id:z,path:i,touched:!1,pending:!1,valid:!0,validated:!!(!((a=le[k])===null||a===void 0)&&a.length),required:P,initialValue:h,errors:rr([]),bails:(u=n?.bails)!==null&&u!==void 0?u:!1,label:n?.label,type:n?.type||"default",value:_,multiple:!1,__flags:{pendingUnmount:{[z]:!1},pendingReset:!1},fieldsCount:1,validate:n?.validate,dirty:D(()=>!ie(Z(_),Z(h)))});return f.value.push(q),I.value[k]=q,N(),re.value[k]&&!le[k]&&J(()=>{fe(k,{mode:"silent"})}),lt(i)&&x(i,W=>{N();const Ve=A(_.value);I.value[W]=q,J(()=>{R(d,W,Ve)})}),q}const Oe=ht(st,5),Re=ht(st,5),je=Mr(async i=>await(i==="silent"?Oe():Re()),(i,[n])=>{const a=G(te.errorBag.value),h=[...new Set([...G(i.results),...f.value.map(V=>V.path),...a])].sort().reduce((V,p)=>{var _;const k=p,U=T(k)||$e(k),P=((_=i.results[k])===null||_===void 0?void 0:_.errors)||[],z=b(U?.path)||k,q=nn({errors:P,valid:!P.length},V.results[z]);return V.results[z]=q,q.valid||(V.errors[z]=q.errors[0]),U&&E.value[z]&&delete E.value[z],U?(U.valid=q.valid,n==="silent"||n==="validated-only"&&!U.validated||B(U,q.errors),V):(B(z,P),V)},{valid:i.valid,results:{},errors:{},source:i.source});return i.values&&(h.values=i.values,h.source=i.source),G(h.results).forEach(V=>{var p;const _=T(V);_&&n!=="silent"&&(n==="validated-only"&&!_.validated||B(_,(p=h.results[V])===null||p===void 0?void 0:p.errors))}),h});function ae(i){f.value.forEach(i)}function T(i){const n=typeof i=="string"?Pe(i):i;return typeof n=="string"?I.value[n]:n}function $e(i){return f.value.filter(a=>i.startsWith(b(a.path))).reduce((a,u)=>a?u.path.length>a.path.length?u:a:u,void 0)}let ue=[],ve;function $(i){return ue.push(i),ve||(ve=J(()=>{[...ue].sort().reverse().forEach(a=>{pt(d,a)}),ue=[],ve=null})),ve}function ee(i){return function(a,u){return function(V){return V instanceof Event&&(V.preventDefault(),V.stopPropagation()),ae(p=>p.touched=!0),o.value=!0,y.value++,me().then(p=>{const _=A(d);if(p.valid&&typeof a=="function"){const k=A(C.value);let U=i?k:_;return p.values&&(U=p.source==="schema"?p.values:Object.assign({},U,p.values)),a(U,{evt:V,controlledValues:k,setErrors:K,setFieldError:B,setTouched:De,setFieldTouched:Ce,setValues:Ue,setFieldValue:ne,resetForm:Be,resetField:rt})}!p.valid&&typeof u=="function"&&u({values:_,evt:V,errors:p.errors,results:p.results})}).then(p=>(o.value=!1,p),p=>{throw o.value=!1,p})}}}const de=ee(!1);de.withControlled=ee(!0);function Nt(i,n){const a=f.value.findIndex(h=>h.path===i&&(Array.isArray(h.id)?h.id.includes(n):h.id===n)),u=f.value[a];if(!(a===-1||!u)){if(J(()=>{fe(i,{mode:"silent",warn:!1})}),u.multiple&&u.fieldsCount&&u.fieldsCount--,Array.isArray(u.id)){const h=u.id.indexOf(n);h>=0&&u.id.splice(h,1),delete u.__flags.pendingUnmount[n]}(!u.multiple||u.fieldsCount<=0)&&(f.value.splice(a,1),nt(i),N(),delete I.value[i])}}function kt(i){G(I.value).forEach(n=>{n.startsWith(i)&&delete I.value[n]}),f.value=f.value.filter(n=>!n.path.startsWith(i)),J(()=>{N()})}const te={name:s,formId:r,values:d,controlledValues:C,errorBag:oe,errors:re,schema:F,submitCount:y,meta:j,isSubmitting:o,isValidating:v,fieldArrays:c,keepValuesOnUnmount:g,validateSchema:Z(F)?je:void 0,validate:me,setFieldError:B,validateField:fe,setFieldValue:ne,setValues:Ue,setErrors:K,setFieldTouched:Ce,setTouched:De,resetForm:Be,resetField:rt,handleSubmit:de,useFieldModel:Dt,defineInputBinds:Bt,defineComponentBinds:Lt,defineField:qe,stageInitialValue:Ut,unsetInitialValue:nt,setFieldInitialValue:Le,createPathState:L,getPathState:T,unsetPathValue:$,removePathState:Nt,initialValues:m,getAllPathStates:()=>f.value,destroyPath:kt,isFieldTouched:Mt,isFieldDirty:Rt,isFieldValid:$t};function ne(i,n,a=!0){const u=A(n),h=typeof i=="string"?i:i.path;T(h)||L(h),R(d,h,u),a&&fe(h)}function Tt(i,n=!0){G(d).forEach(a=>{delete d[a]}),G(i).forEach(a=>{ne(a,i[a],!1)}),n&&me()}function Ue(i,n=!0){Ee(d,i),c.forEach(a=>a&&a.reset()),n&&me()}function ze(i,n){const a=T(b(i))||L(i);return D({get(){return a.value},set(u){var h;const V=b(i);ne(V,u,(h=b(n))!==null&&h!==void 0?h:!1)}})}function Ce(i,n){const a=T(i);a&&(a.touched=n)}function Mt(i){const n=T(i);return n?n.touched:f.value.filter(a=>a.path.startsWith(i)).some(a=>a.touched)}function Rt(i){const n=T(i);return n?n.dirty:f.value.filter(a=>a.path.startsWith(i)).some(a=>a.dirty)}function $t(i){const n=T(i);return n?n.valid:f.value.filter(a=>a.path.startsWith(i)).every(a=>a.valid)}function De(i){if(typeof i=="boolean"){ae(n=>{n.touched=i});return}G(i).forEach(n=>{Ce(n,!!i[n])})}function rt(i,n){var a;const u=n&&"value"in n?n.value:M(m.value,i),h=T(i);h&&(h.__flags.pendingReset=!0),Le(i,A(u),!0),ne(i,u,!1),Ce(i,(a=n?.touched)!==null&&a!==void 0?a:!1),B(i,n?.errors||[]),J(()=>{h&&(h.__flags.pendingReset=!1)})}function Be(i,n){let a=A(i?.values?i.values:O.value);a=n?.force?a:Ee(O.value,a),a=se(F)&&Q(F.cast)?F.cast(a):a,w(a,{force:n?.force}),ae(u=>{var h;u.__flags.pendingReset=!0,u.validated=!1,u.touched=((h=i?.touched)===null||h===void 0?void 0:h[b(u.path)])||!1,ne(b(u.path),M(a,b(u.path)),!1),B(b(u.path),void 0)}),n?.force?Tt(a,!1):Ue(a,!1),K(i?.errors||{}),y.value=i?.submitCount||0,J(()=>{me({mode:"silent"}),ae(u=>{u.__flags.pendingReset=!1})})}async function me(i){const n=i?.mode||"force";if(n==="force"&&ae(p=>p.validated=!0),te.validateSchema)return te.validateSchema(n);v.value=!0;const a=await Promise.all(f.value.map(p=>p.validate?p.validate(i).then(_=>({key:b(p.path),valid:_.valid,errors:_.errors,value:_.value})):Promise.resolve({key:b(p.path),valid:!0,errors:[],value:void 0})));v.value=!1;const u={},h={},V={};for(const p of a)u[p.key]={valid:p.valid,errors:p.errors},p.value&&R(V,p.key,p.value),p.errors.length&&(h[p.key]=p.errors[0]);return{valid:a.every(p=>p.valid),results:u,errors:h,values:V,source:"fields"}}async function fe(i,n){var a;const u=T(i);if(u&&n?.mode!=="silent"&&(u.validated=!0),F){const{results:h}=await je(n?.mode||"validated-only");return h[i]||{errors:[],valid:!0}}return u?.validate?u.validate(n):(!u&&(a=n?.warn),Promise.resolve({errors:[],valid:!0}))}function nt(i){pt(m.value,i)}function Ut(i,n,a=!1){Le(i,n),R(d,i,n),a&&!e?.initialValues&&R(O.value,i,A(n))}function Le(i,n,a=!1){R(m.value,i,A(n)),a&&R(O.value,i,A(n))}async function st(){const i=Z(F);if(!i)return{valid:!0,results:{},errors:{},source:"none"};v.value=!0;const n=Et(i)||se(i)?await Jr(i,d):await Zr(i,d,{names:ye.value,bailsMap:be.value});return v.value=!1,n}const zt=de((i,{evt:n})=>{kr(n)&&n.target.submit()});er(()=>{if(e?.initialErrors&&K(e.initialErrors),e?.initialTouched&&De(e.initialTouched),e?.validateOnMount){me();return}te.validateSchema&&te.validateSchema("silent")}),lt(F)&&x(F,()=>{var i;(i=te.validateSchema)===null||i===void 0||i.call(te,"validated-only")}),at(At,te);function qe(i,n){const a=Q(n)?void 0:n?.label,u=T(b(i))||L(i,{label:a}),h=()=>Q(n)?n(_e(u,Ne)):n||{};function V(){var P;u.touched=!0,((P=h().validateOnBlur)!==null&&P!==void 0?P:we().validateOnBlur)&&fe(b(u.path))}function p(){var P;((P=h().validateOnInput)!==null&&P!==void 0?P:we().validateOnInput)&&J(()=>{fe(b(u.path))})}function _(){var P;((P=h().validateOnChange)!==null&&P!==void 0?P:we().validateOnChange)&&J(()=>{fe(b(u.path))})}const k=D(()=>{const P={onChange:_,onInput:p,onBlur:V};return Q(n)?Object.assign(Object.assign({},P),n(_e(u,Ne)).props||{}):n?.props?Object.assign(Object.assign({},P),n.props(_e(u,Ne))):P});return[ze(i,()=>{var P,z,q;return(q=(P=h().validateOnModelUpdate)!==null&&P!==void 0?P:(z=we())===null||z===void 0?void 0:z.validateOnModelUpdate)!==null&&q!==void 0?q:!0}),k]}function Dt(i){return Array.isArray(i)?i.map(n=>ze(n,!0)):ze(i)}function Bt(i,n){const[a,u]=qe(i,n);function h(){u.value.onBlur()}function V(_){const k=yt(_);ne(b(i),k,!1),u.value.onInput()}function p(_){const k=yt(_);ne(b(i),k,!1),u.value.onChange()}return D(()=>Object.assign(Object.assign({},u.value),{onBlur:h,onInput:V,onChange:p,value:a.value}))}function Lt(i,n){const[a,u]=qe(i,n),h=T(b(i));function V(p){a.value=p}return D(()=>{const p=Q(n)?n(_e(h,Ne)):n||{};return Object.assign({[p.model||"modelValue"]:a.value,[`onUpdate:${p.model||"modelValue"}`]:V},u.value)})}const it=Object.assign(Object.assign({},te),{values:Vt(d),handleReset:()=>Be(),submitForm:zt});return at(jr,it),it}function tn(e,t,r,s){const l={touched:"some",pending:"some",valid:"every"},o=D(()=>!ie(t,Z(r)));function v(){const c=e.value;return G(l).reduce((d,f)=>{const E=l[f];return d[f]=c[E](I=>I[f]),d},{})}const y=ke(v());return St(()=>{const c=v();y.touched=c.touched,y.valid=c.valid,y.pending=c.pending}),D(()=>Object.assign(Object.assign({initialValues:Z(r)},y),{valid:y.valid&&!G(s.value).length,dirty:o.value}))}function rn(e,t,r){const s=_t(r),l=Y(s),o=Y(A(s));function v(y,c){c?.force?(l.value=A(y),o.value=A(y)):(l.value=Ee(A(l.value)||{},A(y)),o.value=Ee(A(o.value)||{},A(y))),c?.updateFields&&e.value.forEach(d=>{if(d.touched)return;const E=M(l.value,b(d.path));R(t,b(d.path),A(E))})}return{initialValues:l,originalInitialValues:o,setInitialValues:v}}function nn(e,t){return t?{valid:e.valid&&t.valid,errors:[...e.errors,...t.errors]}:e}function Ot(e){const t=Tr(At,void 0),r=Y([]),s=()=>{},l={fields:r,remove:s,push:s,swap:s,insert:s,update:s,replace:s,prepend:s,move:s};if(!t||!Z(e))return l;const o=t.fieldArrays.find(g=>Z(g.path)===Z(e));if(o)return o;let v=0;function y(){return M(t?.values,b(e),[])||[]}function c(){const g=y();Array.isArray(g)&&(r.value=g.map((m,O)=>f(m,O,r.value)),d())}c();function d(){const g=r.value.length;for(let m=0;m<g;m++){const O=r.value[m];O.isFirst=m===0,O.isLast=m===g-1}}function f(g,m,O){if(O&&!he(m)&&O[m])return O[m];const w=v++;return{key:w,value:Rr({get(){const C=M(t?.values,b(e),[])||[],F=r.value.findIndex(L=>L.key===w);return F===-1?g:C[F]},set(C){const F=r.value.findIndex(L=>L.key===w);F!==-1&&re(F,C)}}),isFirst:!1,isLast:!1}}function E(){d(),t?.validate({mode:"silent"})}function I(g){const m=b(e),O=M(t?.values,m);if(!O||!Array.isArray(O))return;const w=[...O];w.splice(g,1);const j=m+`[${g}]`;t.destroyPath(j),t.unsetInitialValue(j),R(t.values,m,w),r.value.splice(g,1),E()}function N(g){const m=A(g),O=b(e),w=M(t?.values,O),j=he(w)?[]:w;if(!Array.isArray(j))return;const C=[...j];C.push(m),t.stageInitialValue(O+`[${C.length-1}]`,m),R(t.values,O,C),r.value.push(f(m)),E()}function B(g,m){const O=b(e),w=M(t?.values,O);if(!Array.isArray(w)||!(g in w)||!(m in w))return;const j=[...w],C=[...r.value],F=j[g];j[g]=j[m],j[m]=F;const L=C[g];C[g]=C[m],C[m]=L,R(t.values,O,j),r.value=C,d()}function K(g,m){const O=A(m),w=b(e),j=M(t?.values,w);if(!Array.isArray(j)||j.length<g)return;const C=[...j],F=[...r.value];C.splice(g,0,O),F.splice(g,0,f(O)),R(t.values,w,C),r.value=F,E()}function oe(g){const m=b(e);t.stageInitialValue(m,g),R(t.values,m,g),c(),E()}function re(g,m){const O=b(e),w=M(t?.values,O);!Array.isArray(w)||w.length-1<g||(R(t.values,`${O}[${g}]`,m),t?.validate({mode:"validated-only"}))}function ye(g){const m=A(g),O=b(e),w=M(t?.values,O),j=he(w)?[]:w;if(!Array.isArray(j))return;const C=[m,...j];R(t.values,O,C),t.stageInitialValue(O+"[0]",m),r.value.unshift(f(m)),E()}function be(g,m){const O=b(e),w=M(t?.values,O),j=he(w)?[]:[...w];if(!Array.isArray(w)||!(g in w)||!(m in w))return;const C=[...r.value],F=C[g];C.splice(g,1),C.splice(m,0,F);const L=j[g];j.splice(g,1),j.splice(m,0,L),R(t.values,O,j),r.value=C,E()}const le={fields:r,remove:I,push:N,swap:B,insert:K,update:re,replace:oe,prepend:ye,move:be};return t.fieldArrays.push(Object.assign({path:e,reset:c},le)),tr(()=>{const g=t.fieldArrays.findIndex(m=>b(m.path)===b(e));g>=0&&t.fieldArrays.splice(g,1)}),x(y,g=>{const m=r.value.map(O=>O.value);ie(g,m)||c()}),le}const sn=["type","value"],on={key:0,class:"text-red-400"},ln=Je({__name:"CustomInput",props:{modelValue:{},error:{},type:{default:"text"}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(X(),H("div",null,[S("input",{type:e.type,value:e.modelValue,onInput:r[0]||(r[0]=s=>t.$emit("update:modelValue",s.target?.value??"")),onBlur:r[1]||(r[1]=s=>t.$emit("blur")),class:xe(["form-control",{"border-red-500":e.error}])},null,42,sn),e.error?(X(),H("span",on,Ae(e.error),1)):Ze("",!0)]))}}),an=wt(ln,[["__scopeId","data-v-2664bc3f"]]),un=["value"],cn={key:0,class:"text-red-400"},dn=Je({__name:"CustomTextArea",props:{modelValue:{},error:{}},emits:["update:modelValue","blur"],setup(e){return(t,r)=>(X(),H("div",null,[S("textarea",{value:e.modelValue,onInput:r[0]||(r[0]=s=>t.$emit("update:modelValue",s.target?.value??"")),onBlur:r[1]||(r[1]=s=>t.$emit("blur")),class:xe(["shadow h-32 appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",{"border-red-500":e.error}])},null,42,un),e.error?(X(),H("span",cn,Ae(e.error),1)):Ze("",!0)]))}}),fn=lr({title:Ie().required().min(3),slug:Ie().required(),description:Ie().required(),price:ut().required(),stock:ut().required().min(1),gender:Ie().required().oneOf(["men","women","kid"])}),vn=Je({components:{CustomInput:an,CustomTextArea:dn},props:{productId:{type:String,require:!0}},setup(e){const t=ir(),r=or(),{data:s,isError:l,isLoading:o,refetch:v}=vr({queryKey:["product",e.productId],queryFn:()=>hr(e.productId),retry:!1}),{mutate:y,isPending:c,isSuccess:d,data:f}=pr({mutationFn:gr}),{values:E,defineField:I,errors:N,handleSubmit:B,resetForm:K,meta:oe}=en({validationSchema:fn}),[re,ye]=I("title"),[be,le]=I("slug"),[g,m]=I("description"),[O,w]=I("price"),[j,C]=I("stock"),[F,L]=I("gender"),{fields:Oe,remove:Re,push:je}=Ot("sizes"),{fields:ae}=Ot("images"),T=Y([]),$e=B(async $=>{const ee={...$,images:[...$.images,...T.value]};y(ee)}),ue=$=>{const ee=Oe.value.map(de=>de.value);ee.includes($)?Re(ee.indexOf($)):je($)},ve=$=>{const ce=$.target.files;if(ce&&ce.length!==0)for(const de of ce)T.value.push(de)};return St(()=>{if(l.value&&!o.value){t.replace("/admin/products");return}}),x(s,()=>{s&&K({values:s.value})},{deep:!0,immediate:!0}),x(d,$=>{$&&(r.success("Producto actualizado correctamente"),t.replace(`/admin/products/${f.value.id}`),K({values:f.value}),T.value=[])}),x(()=>e.productId,()=>{v()}),{values:E,errors:N,meta:oe,title:re,titleAttrs:ye,slug:be,slugAttrs:le,description:g,descriptionAttrs:m,price:O,priceAttrs:w,stock:j,stockAttrs:C,gender:F,genderAttrs:L,isPending:c,onFilesChanged:ve,sizes:Oe,images:ae,imageFiles:T,allSizes:["XS","S","M","L","XL","XXL"],onSubmit:$e,toggleSize:ue,hasSize:$=>Oe.value.map(ce=>ce.value).includes($),temporalImageUrl:$=>URL.createObjectURL($)}}}),mn={class:"bg-white px-5 py-2 rounded"},pn={class:"text-3xl"},hn={class:"text-blue-500"},gn={class:"first-col"},yn={class:"mb-4"},bn={class:"mb-4"},On={class:"mb-4"},Vn={class:"flex flex-row gap-3"},Sn={class:"mb-4 flex-1"},wn={class:"mb-4 flex-1"},An={class:"mb-4"},En={class:"flex"},jn=["onClick"],Cn={class:"first-col"},In={class:"flex p-2 overflow-x-auto space-x-8 w-full h-66.25 bg-gray-200 rounded"},Fn=["src","alt"],Pn=["src","alt"],_n={class:"col-span-2 my-2"},Nn={class:"mb-4"},kn={key:0,class:"text-red-400"},Tn={class:"my-4 text-right"},Mn=["disabled"];function Rn(e,t,r,s,l,o){const v=ct("CustomInput"),y=ct("CustomTextArea");return X(),H(Fe,null,[S("div",mn,[S("h1",pn,[t[8]||(t[8]=ar(" Producto: ",-1)),S("small",hn,Ae(e.title),1)]),t[9]||(t[9]=S("hr",{class:"my-4"},null,-1))]),S("form",{onSubmit:t[7]||(t[7]=(...c)=>e.onSubmit&&e.onSubmit(...c)),class:"grid grid-cols-1 sm:grid-cols-2 bg-white px-5 gap-5"},[S("div",gn,[S("div",yn,[t[10]||(t[10]=S("label",{for:"title",class:"form-label"},"Título",-1)),Se(v,pe({modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=c=>e.title=c)},e.titleAttrs,{error:e.errors.title}),null,16,["modelValue","error"])]),S("div",bn,[t[11]||(t[11]=S("label",{for:"slug",class:"form-label"},"Slug",-1)),Se(v,pe({modelValue:e.slug,"onUpdate:modelValue":t[1]||(t[1]=c=>e.slug=c)},e.slugAttrs,{error:e.errors.slug}),null,16,["modelValue","error"])]),S("div",On,[t[12]||(t[12]=S("label",{for:"description",class:"form-label"},"Descripción",-1)),Se(y,pe({modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=c=>e.description=c)},e.descriptionAttrs,{error:e.errors.description}),null,16,["modelValue","error"])]),S("div",Vn,[S("div",Sn,[t[13]||(t[13]=S("label",{for:"price",class:"form-label"},"Precio",-1)),Se(v,pe({modelValue:e.price,"onUpdate:modelValue":t[3]||(t[3]=c=>e.price=c),modelModifiers:{number:!0}},e.priceAttrs,{error:e.errors.price}),null,16,["modelValue","error"])]),S("div",wn,[t[14]||(t[14]=S("label",{for:"stock",class:"form-label"},"Inventario",-1)),Se(v,pe({modelValue:e.stock,"onUpdate:modelValue":t[4]||(t[4]=c=>e.stock=c),modelModifiers:{number:!0}},e.stockAttrs,{error:e.errors.stock}),null,16,["modelValue","error"])])]),S("div",An,[t[15]||(t[15]=S("label",{for:"sizes",class:"form-label"},"Tallas",-1)),S("div",En,[(X(!0),H(Fe,null,Xe(e.allSizes,c=>(X(),H("button",{key:c,onClick:d=>e.toggleSize(c),type:"button",class:xe(["p-2 rounded w-14 mr-2 flex-1",{"bg-blue-500 text-white":e.hasSize(c),"bg-blue-100 ":!e.hasSize(c)}])},Ae(c),11,jn))),128))])])]),S("div",Cn,[t[19]||(t[19]=S("label",{for:"stock",class:"form-label"},"Imágenes",-1)),S("div",In,[(X(!0),H(Fe,null,Xe(e.images,c=>(X(),H("div",{key:c.value,class:"flex-shrink-0"},[S("img",{src:c.value,alt:e.title,class:"w-66.5 h-66.5 rounded"},null,8,Fn)]))),128)),(X(!0),H(Fe,null,Xe(e.imageFiles,c=>(X(),H("div",{key:c.name,class:"flex-shrink-0"},[S("img",{src:e.temporalImageUrl(c),alt:e.title,class:"w-66.5 h-66.5 rounded"},null,8,Pn)]))),128))]),S("div",_n,[t[16]||(t[16]=S("label",{for:"image",class:"form-label"},"Subir imagen",-1)),S("input",{multiple:"",type:"file",id:"image",class:"form-control",accept:"image/*",onChange:t[5]||(t[5]=(...c)=>e.onFilesChanged&&e.onFilesChanged(...c))},null,32)]),S("div",Nn,[t[18]||(t[18]=S("label",{for:"stock",class:"form-label"},"Género",-1)),ur(S("select",pe({"onUpdate:modelValue":t[6]||(t[6]=c=>e.gender=c)},e.genderAttrs,{class:"form-control"}),[...t[17]||(t[17]=[S("option",{value:""},"Seleccione",-1),S("option",{value:"kid"},"Niño",-1),S("option",{value:"women"},"Mujer",-1),S("option",{value:"men"},"Hombre",-1)])],16),[[cr,e.gender]]),e.errors.gender?(X(),H("span",kn,Ae(e.errors.gender),1)):Ze("",!0)]),S("div",Tn,[S("button",{disabled:e.isPending,type:"submit",class:"disabled:bg-gray-300 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," Guardar ",8,Mn)])])],32)],64)}const zn=wt(vn,[["render",Rn],["__scopeId","data-v-0e0c9dd0"]]);export{zn as default};
